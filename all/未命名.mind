{"root":{"data":{"id":"daeg9ns36ko0","created":1749111468543,"text":"分期入库","expandState":"expand"},"children":[{"data":{"id":"daegdh3nb3s0","created":1749111767461,"text":"页面执行按钮","expandState":"expand","note":"在采购订单页表页, \"选项\"菜单下, 增加下拉按钮 \"分期出入库\"\n\t选项1: 全量处理\n\t选项2: 勾选处理 PS: 只处理列表勾选的订单","priority":1},"children":[{"data":{"id":"daegaqpxaoo0","created":1749111553307,"text":"匹配销售订单","layout_mind_offset":{"x":248,"y":7},"note":"根据一下条件,建立采购订单与销售订单的关联关系\n\n筛选条件:\n未筛选下有31198条单据 (2025-05-30)\n筛选条件下579条单据\n1. 采购订单, 付款条件≠备件专用季度结算, 单据日期>=2025, 审核状态=已审核, 关闭状态=未关闭, 作废状态=未作废\n2. 根据采购订单的项目编码, 匹配销售订单项目编码, 且销售订单单据类型=服务销售\n\nPS: 如果销售订单条数大于1则跳过, 结束后续动作, 继续处理下一条","layout_right_offset":{"x":4,"y":-10},"priority":2},"children":[{"data":{"id":"daehatxes9c0","created":1749114381400,"text":"销售订单数量 = 1","layout_right_offset":{"x":52,"y":19}},"children":[{"data":{"id":"daeh7srvtrk0","created":1749114143796,"text":"确认应收账期数 > 1","layout_right_offset":{"x":63,"y":46}},"children":[{"data":{"id":"daegbni7l8w0","created":1749111624674,"text":"正常情况","note":"将销售订单的分期数据回写给到采购订单\n\n1. 将销售订单的 服务开始时间, 服务终止时间, 销售订单编号 填入至采购订单对应字段\n2. 确认应付账期数从\"确认应付记录\"按钮执行生成\n3. 采购订单单据头, 新增一个字段 \"销售订单编号\"","expandState":"expand","priority":null,"layout_right_offset":{"x":146,"y":-84}},"children":[{"data":{"id":"daegbxh7p340","created":1749111646382,"text":"采购订单服务时间 为空","expandState":"expand","layout_right_offset":{"x":41,"y":-33}},"children":[{"data":{"id":"dahva6axtnk0","created":1749458505384,"text":"服务时间回写","priority":3,"layout_right_offset":{"x":80.74999919906259,"y":-4.999999925494251},"note":"将销售订单的分期数据回写给到采购订单\n\n1. 将销售订单的 服务开始时间, 服务终止时间, 销售订单编号 填入至采购订单对应字段\n2. 采购订单 确认支出类型 默认为0\n\n确认应付账期数从\"确认应付记录\"按钮执行生成\n3. 采购订单单据头, 新增一个字段 \"销售订单编号\""},"children":[{"data":{"id":"daegnjh8x740","created":1749112556279,"text":"生成应付记录","note":"根据采购订单的分期数据, 生成应付记录\n\n1.触发\"确认应付记录\"按钮","priority":4,"layout_right_offset":{"x":107.49999988824129,"y":-1.0000000745057491}},"children":[{"data":{"id":"daegrsqdvy80","created":1749112889879,"text":"下推采购入库单","priority":5,"note":"根据应付记录, 下推采购入库单\n\n1. 下推应付记录期间<=本期的所有采购入库单, 并且给应付记录 勾选上 \"是否已缴费\"\n\nPS: 带上销售订单号, 分期标识","layout_right_offset":{"x":61,"y":-1}},"children":[]}]}]}]},{"data":{"id":"daegvi9q8ag0","created":1749113180561,"text":"采购订单服务时间与销售订单一致","layout_right_offset":{"x":40,"y":29}},"children":[{"data":{"id":"dakgkoncbuw0","created":1749721692179,"text":"校验已缴费金额和采购入库单金额","layout_right_offset":{"x":101.24999849125743,"y":-2.499999962747097}},"children":[{"data":{"id":"dakgkw2aqxc0","created":1749721708321,"text":"一致","layout_right_offset":{"x":72.49999891966581,"y":-31.249999534338713}},"children":[{"data":{"id":"daeh01kdigg0","created":1749113536020,"text":"下推采购入库单","layout_right_offset":{"x":259.25000385567546,"y":-5.7500000931322575},"priority":5,"note":"根据应付记录, 下推采购入库单\n\n1. 根据当期应付记录下推采购入库单, 并且给应付记录 勾选上 \"是否已缴费\"\n\nPS: 带上销售订单号, 分期标识"},"children":[]}]},{"data":{"id":"dakgl0x70v40","created":1749721718896,"text":"不一致","layout_right_offset":{"x":68.74999897554517,"y":16.24999975785613},"note":"1. 程序做错误提醒, 强调需要人工介入检查\n2. 人工介入调整后, 财务手动勾选执行分期出入库"},"children":[]}]}]}]},{"data":{"id":"dahvaoaqtgg0","created":1749458544554,"text":"非正常情况","layout_right_offset":{"x":151.49999802559626,"y":39.00000089406973}},"children":[{"data":{"id":"daegfzhs5480","created":1749111964227,"text":"采购订单与销售订单不一致","layout_right_offset":{"x":80.99999940395355,"y":-40.74999994412062}},"children":[{"data":{"id":"dahubiv5q1k0","created":1749455789982,"text":"仅服务时间不一致","layout_right_offset":{"x":106.74999852851033,"y":-1}},"children":[{"data":{"id":"dahus5zjwmg0","created":1749457094140,"text":"校验已缴费金额和采购入库单金额","note":"1. 校验已缴费金额和采购入库单金额是否一致\n2. 校验已缴费期数和采购入库单期数是否一致","layout_right_offset":{"x":81.24999878928065,"y":-1.2499999813735485}},"children":[{"data":{"id":"dakcscqhujk0","created":1749711008722,"text":"一致","layout_right_offset":{"x":82.49999877065443,"y":-43.7499993480742}},"children":[{"data":{"id":"dakgczx1waw0","created":1749721089797,"text":"服务时间回写","priority":3,"layout_right_offset":{"x":36.24999945983291,"y":-4.999999925494194}},"children":[{"data":{"id":"dahuowqaqn40","created":1749456838897,"text":"已缴费期间<变更后总服务期间","layout_right_offset":{"x":51,"y":-10},"note":"1"},"children":[{"data":{"id":"daegqnw00co0","created":1749112800971,"text":"生成应付记录","priority":4,"layout_right_offset":{"x":62,"y":-3},"note":"根据采购订单的分期数据, 生成应付记录\n\n1. 根据采购订单金额 减 已缴费金额, 得出后续要分期的金额, 除以剩余的期数, 然后将未缴费的应付记录删除, 重新生成应付记录, 重新分配剩余分期金额"},"children":[{"data":{"id":"daegrzxtw8g0","created":1749112905567,"text":"下推采购入库单","priority":5,"layout_right_offset":{"x":87,"y":-1},"note":"1. 根据当期应付记录下推采购入库单, 并且给应付记录 勾选上 \"是否已缴费\"\n\nPS: 带上销售订单号, 分期标识"},"children":[]}]}]},{"data":{"id":"dahuozoenw80","created":1749456845313,"text":"已缴费期间>=变更后总服务期间","note":"1. 重置已缴费期间 = 变更后总服务期间-1 (根据期数倒序退)\n2. 程序做错误提醒, 强调需要做退货推料","layout_right_offset":{"x":53,"y":0}},"children":[{"data":{"id":"dakdbwilvqw0","created":1749712540700,"text":"人工介入","layout_right_offset":{"x":96.24999856576324,"y":1.2499999813735485},"note":"程序做错误提醒, 强调需要做退货推料\n\n1. 商务退货, 采购退料\n2. 之后财务在采购订单列表, 勾选此单据进行分期出入库处理"},"children":[]}]}]}]},{"data":{"id":"dakct0erfmo0","created":1749711060255,"text":"不一致","layout_right_offset":{"x":78.74999882653378,"y":46.24999931082118},"note":"1. 程序做错误提醒, 强调需要人工介入检查\n2. 人工介入调整后, 财务手动勾选执行分期出入库"},"children":[]}]}]}]},{"data":{"id":"dahucnxhqnk0","created":1749455879371,"text":"采购订单新变更单","layout_right_offset":{"x":98.74999957159162,"y":98.24999960884452},"note":"这种情况, 应该单独处理, 即属于分期的采购订单新变更单, 审核前节点立即处理\n\n1. 在采购订单新变更单的已审核节点, 增加被动式触发操作","progress":null},"children":[{"data":{"id":"dahwy6kwwxc0","created":1749463207837,"text":"仅金额变更","layout_right_offset":{"x":64,"y":-25}},"children":[{"data":{"id":"dakghnx1eqg0","created":1749721455496,"text":"校验已缴费金额和采购入库单金额","note":"1. 校验已缴费金额和采购入库单金额是否一致\n2. 校验已缴费期数和采购入库单期数是否一致","layout_right_offset":{"x":51.24999923631549,"y":-1.2499999813735485}},"children":[{"data":{"id":"dakghu2lv480","created":1749721468893,"text":"一致","layout_right_offset":{"x":62.499999068677425,"y":-26.249999608844604}},"children":[{"data":{"id":"dakdt9xlo340","created":1749713902095,"text":"已缴费金额<采购订单金额","layout_right_offset":{"x":98.74999852851033,"y":0}},"children":[{"data":{"id":"dakdug8x0lc0","created":1749713994204,"text":"重置剩余应付记录","priority":4,"layout_right_offset":{"x":98.74999852851033,"y":-2.499999962747097},"note":"1. 将未勾选的应付记录, 全部删除\n2. 生成应付记录 = (采购订单金额-已缴费金额)/剩余期数"},"children":[{"data":{"id":"dakdvaxsmnk0","created":1749714061012,"text":"下推采购入库单","layout_right_offset":{"x":128.7499980814755,"y":0},"priority":5},"children":[]}]}]},{"data":{"id":"dakdtmjal0g0","created":1749713929528,"text":"已缴费金额>采购订单金额","layout_right_offset":{"x":119.99999821186066,"y":16.24999975785613}},"children":[{"data":{"id":"dakdbwilvqw0","created":1749712540700,"text":"人工介入","layout_right_offset":{"x":104.99999843537807,"y":-2.4999999627469833},"note":"程序做错误提醒, 强调需要做退货推料\n\n1. 商务退货, 采购退料(在采购订单变更单时已介入)\n2. 入库单金额退料至与采购订单金额一致\n\n"},"children":[]}]},{"data":{"id":"dakdu23jmy80","created":1749713963405,"text":"已缴费金额=采购订单金额","layout_right_offset":{"x":129.99999806284904,"y":38.74999942258006}},"children":[{"data":{"id":"dakdw0q0f6o0","created":1749714117138,"text":"删除剩余应付记录","layout_right_offset":{"x":93.74999860301614,"y":-2.499999962747097},"priority":4,"note":"1. 将未勾选的应付记录删除"},"children":[]}]}]},{"data":{"id":"dakghwna4e00","created":1749721474497,"text":"不一致","layout_right_offset":{"x":59.99999910593033,"y":31.249999534338826},"note":"1. 程序做错误提醒, 强调需要人工介入检查\n2. 中断变更单审核动作\n3. 人工介入调整已缴费金额和采购入库单金额一致后, 重新审核执行\n"},"children":[]}]}]},{"data":{"id":"dahwy7t5oyw0","created":1749463210512,"text":"项目变更","layout_right_offset":{"x":68,"y":61}},"children":[{"data":{"id":"dakel7bwosw0","created":1749716090628,"text":"人工介入","layout_right_offset":{"x":73,"y":-2},"note":"1. 商务退货,采购退料 (全退)\n2. 采购做采购订单新变更单, 财务审核"},"children":[{"data":{"id":"dake9ih7kpc0","created":1749715174522,"text":"清理下游数据","layout_right_offset":{"x":86,"y":-1},"note":"程序做错误提醒, 强调需要做退货推料\n\n1. 将已勾选/未勾选应付记录 全部删除"},"children":[]}]}]}]}]}]},{"data":{"id":"daeh7vq8cg80","created":1749114150227,"text":"确认应收账期数 <= 1 OR 为空","layout_right_offset":{"x":61,"y":-47},"progress":null},"children":[]}]},{"data":{"id":"daehavvdajs0","created":1749114385630,"text":"销售订单数量 ≠ 1","priority":null,"progress":null,"layout_right_offset":{"x":49,"y":-11}},"children":[]}]}]},{"data":{"id":"dantsq2bru00","created":1750063676474,"text":"全局备注","layout_mind_offset":{"x":306,"y":105},"note":"1. 期数计算公式:\n(dateTime2.Year - dateTime.Year) * 12 + dateTime2.Month - dateTime.Month\n(服务终止时间年份-服务开始时间年份)*12+服务终止时间月份-服务开始时间月份\n\n2. 期数归集:\n服务开始时间在当月15号以前(含15号), 则在当月触发, 如果在15号之后, 则在次月触发 \n\n3. 采购入库单新增字段\n3.1 销售订单编号\n3.2 入库账期\n3.3 辅助金额\n3.4 应付记录-缴费日期\n\n4. 其他出库单新增字段\n4.1 销售订单编号\n4.2 出库账期\n4.3 辅助金额\n\n5. BOS后台配置单据转换规则 (采购订单下推其他出库单), 加入新增字段转换\n\n6. 操作执行计划列表, 将\"采购自动产生应付\"执行计划停用, 并且发布新的执行计划\n\n7. 在采购订单中将\"采购信息\",\"提货方式\",\"交易方式\"设为必填 (对接罗鹏飞)\n\n8. 将物料列表中的所有未禁用物料, 维护批号规则 (对接陈伟强)"},"children":[]}]},"template":"right","theme":"fish","version":"1.4.43"}