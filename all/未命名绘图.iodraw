<mxfile host="www.iodraw.com" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36" version="24.7.17">
  <diagram name="第 1 页" id="iFYjDJFjouQlnOXAfu06">
    <mxGraphModel dx="1434" dy="746" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="Ucl1qVDXu87t6qx1oQF--2" value="{&quot;root&quot;:{&quot;data&quot;:{&quot;id&quot;:&quot;daeg9ns36ko0&quot;,&quot;created&quot;:1749111468543,&quot;text&quot;:&quot;分期入库&quot;,&quot;expandState&quot;:&quot;expand&quot;},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;daegdh3nb3s0&quot;,&quot;created&quot;:1749111767461,&quot;text&quot;:&quot;页面执行按钮&quot;,&quot;expandState&quot;:&quot;expand&quot;,&quot;note&quot;:&quot;在采购订单页表页, \&quot;选项\&quot;菜单下, 增加下拉按钮 \&quot;分期出入库\&quot;\n\t选项1: 全量处理\n\t选项2: 勾选处理 PS: 只处理列表勾选的订单&quot;,&quot;priority&quot;:1},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;daegaqpxaoo0&quot;,&quot;created&quot;:1749111553307,&quot;text&quot;:&quot;匹配销售订单&quot;,&quot;layout_mind_offset&quot;:{&quot;x&quot;:248,&quot;y&quot;:7},&quot;note&quot;:&quot;根据一下条件,建立采购订单与销售订单的关联关系\n\n筛选条件:\n未筛选下有31198条单据 (2025-05-30)\n筛选条件下579条单据\n1. 采购订单, 付款条件≠备件专用季度结算, 单据日期&amp;gt;=2025, 审核状态=已审核, 关闭状态=未关闭, 作废状态=未作废\n2. 根据采购订单的项目编码, 匹配销售订单项目编码, 且销售订单单据类型=服务销售\n\nPS: 如果销售订单条数大于1则跳过, 结束后续动作, 继续处理下一条&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:4,&quot;y&quot;:-10},&quot;priority&quot;:2},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;daehatxes9c0&quot;,&quot;created&quot;:1749114381400,&quot;text&quot;:&quot;销售订单数量 = 1&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:52,&quot;y&quot;:19}},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;daeh7srvtrk0&quot;,&quot;created&quot;:1749114143796,&quot;text&quot;:&quot;确认应收账期数 &amp;gt; 1&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:59,&quot;y&quot;:38}},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;daegbni7l8w0&quot;,&quot;created&quot;:1749111624674,&quot;text&quot;:&quot;正常情况&quot;,&quot;note&quot;:&quot;将销售订单的分期数据回写给到采购订单\n\n1. 将销售订单的 服务开始时间, 服务终止时间, 销售订单编号 填入至采购订单对应字段\n2. 确认应付账期数从\&quot;确认应付记录\&quot;按钮执行生成\n3. 采购订单单据头, 新增一个字段 \&quot;销售订单编号\&quot;&quot;,&quot;expandState&quot;:&quot;expand&quot;,&quot;priority&quot;:null,&quot;layout_right_offset&quot;:{&quot;x&quot;:146,&quot;y&quot;:-84}},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;daegbxh7p340&quot;,&quot;created&quot;:1749111646382,&quot;text&quot;:&quot;采购订单服务时间 为空&quot;,&quot;expandState&quot;:&quot;expand&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:41,&quot;y&quot;:-33}},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;dahva6axtnk0&quot;,&quot;created&quot;:1749458505384,&quot;text&quot;:&quot;服务时间回写&quot;,&quot;priority&quot;:3,&quot;layout_right_offset&quot;:{&quot;x&quot;:80.74999919906259,&quot;y&quot;:-4.999999925494251},&quot;note&quot;:&quot;将销售订单的分期数据回写给到采购订单\n\n1. 将销售订单的 服务开始时间, 服务终止时间, 销售订单编号 填入至采购订单对应字段\n2. 采购订单 确认支出类型 默认为0\n\n确认应付账期数从\&quot;确认应付记录\&quot;按钮执行生成\n3. 采购订单单据头, 新增一个字段 \&quot;销售订单编号\&quot;&quot;},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;daegnjh8x740&quot;,&quot;created&quot;:1749112556279,&quot;text&quot;:&quot;生成应付记录&quot;,&quot;note&quot;:&quot;根据采购订单的分期数据, 生成应付记录\n\n1.触发\&quot;确认应付记录\&quot;按钮&quot;,&quot;priority&quot;:4,&quot;layout_right_offset&quot;:{&quot;x&quot;:107.49999988824129,&quot;y&quot;:-1.0000000745057491}},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;daegrsqdvy80&quot;,&quot;created&quot;:1749112889879,&quot;text&quot;:&quot;下推采购入库单&quot;,&quot;priority&quot;:5,&quot;note&quot;:&quot;根据应付记录, 下推采购入库单\n\n1. 下推应付记录期间&amp;lt;=本期的所有采购入库单, 并且给应付记录 勾选上 \&quot;是否已缴费\&quot;\n\nPS: 带上销售订单号, 分期标识&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:61,&quot;y&quot;:-1}},&quot;children&quot;:[]}]}]}]},{&quot;data&quot;:{&quot;id&quot;:&quot;daegvi9q8ag0&quot;,&quot;created&quot;:1749113180561,&quot;text&quot;:&quot;采购订单服务时间与销售订单一致&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:40,&quot;y&quot;:29}},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;dakgkoncbuw0&quot;,&quot;created&quot;:1749721692179,&quot;text&quot;:&quot;校验已缴费金额和采购入库单金额&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:101.24999849125743,&quot;y&quot;:-2.499999962747097}},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;dakgkw2aqxc0&quot;,&quot;created&quot;:1749721708321,&quot;text&quot;:&quot;一致&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:72.49999891966581,&quot;y&quot;:-31.249999534338713}},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;daeh01kdigg0&quot;,&quot;created&quot;:1749113536020,&quot;text&quot;:&quot;下推采购入库单&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:259.25000385567546,&quot;y&quot;:-5.7500000931322575},&quot;priority&quot;:5,&quot;note&quot;:&quot;根据应付记录, 下推采购入库单\n\n1. 根据当期应付记录下推采购入库单, 并且给应付记录 勾选上 \&quot;是否已缴费\&quot;\n\nPS: 带上销售订单号, 分期标识&quot;},&quot;children&quot;:[]}]},{&quot;data&quot;:{&quot;id&quot;:&quot;dakgl0x70v40&quot;,&quot;created&quot;:1749721718896,&quot;text&quot;:&quot;不一致&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:68.74999897554517,&quot;y&quot;:16.24999975785613},&quot;note&quot;:&quot;1. 程序做错误提醒, 强调需要人工介入检查\n2. 人工介入调整后, 财务手动勾选执行分期出入库&quot;},&quot;children&quot;:[]}]}]}]},{&quot;data&quot;:{&quot;id&quot;:&quot;dahvaoaqtgg0&quot;,&quot;created&quot;:1749458544554,&quot;text&quot;:&quot;非正常情况&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:151.49999802559626,&quot;y&quot;:39.00000089406973}},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;daegfzhs5480&quot;,&quot;created&quot;:1749111964227,&quot;text&quot;:&quot;采购订单与销售订单不一致&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:80.99999940395355,&quot;y&quot;:-40.74999994412062}},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;dahubiv5q1k0&quot;,&quot;created&quot;:1749455789982,&quot;text&quot;:&quot;仅服务时间不一致&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:106.74999852851033,&quot;y&quot;:-1}},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;dahus5zjwmg0&quot;,&quot;created&quot;:1749457094140,&quot;text&quot;:&quot;校验已缴费金额和采购入库单金额&quot;,&quot;note&quot;:&quot;1. 校验已缴费金额和采购入库单金额是否一致\n2. 校验已缴费期数和采购入库单期数是否一致&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:81.24999878928065,&quot;y&quot;:-1.2499999813735485}},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;dakcscqhujk0&quot;,&quot;created&quot;:1749711008722,&quot;text&quot;:&quot;一致&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:82.49999877065443,&quot;y&quot;:-43.7499993480742}},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;dakgczx1waw0&quot;,&quot;created&quot;:1749721089797,&quot;text&quot;:&quot;服务时间回写&quot;,&quot;priority&quot;:3,&quot;layout_right_offset&quot;:{&quot;x&quot;:36.24999945983291,&quot;y&quot;:-4.999999925494194}},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;dahuowqaqn40&quot;,&quot;created&quot;:1749456838897,&quot;text&quot;:&quot;已缴费期间&amp;lt;变更后总服务期间&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:51,&quot;y&quot;:-10},&quot;note&quot;:&quot;1&quot;},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;daegqnw00co0&quot;,&quot;created&quot;:1749112800971,&quot;text&quot;:&quot;生成应付记录&quot;,&quot;priority&quot;:4,&quot;layout_right_offset&quot;:{&quot;x&quot;:62,&quot;y&quot;:-3},&quot;note&quot;:&quot;根据采购订单的分期数据, 生成应付记录\n\n1. 根据采购订单金额 减 已缴费金额, 得出后续要分期的金额, 除以剩余的期数, 然后将未缴费的应付记录删除, 重新生成应付记录, 重新分配剩余分期金额&quot;},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;daegrzxtw8g0&quot;,&quot;created&quot;:1749112905567,&quot;text&quot;:&quot;下推采购入库单&quot;,&quot;priority&quot;:5,&quot;layout_right_offset&quot;:{&quot;x&quot;:87,&quot;y&quot;:-1},&quot;note&quot;:&quot;1. 根据当期应付记录下推采购入库单, 并且给应付记录 勾选上 \&quot;是否已缴费\&quot;\n\nPS: 带上销售订单号, 分期标识&quot;},&quot;children&quot;:[]}]}]},{&quot;data&quot;:{&quot;id&quot;:&quot;dahuozoenw80&quot;,&quot;created&quot;:1749456845313,&quot;text&quot;:&quot;已缴费期间&amp;gt;=变更后总服务期间&quot;,&quot;note&quot;:&quot;1. 重置已缴费期间 = 变更后总服务期间-1 (根据期数倒序退)\n2. 程序做错误提醒, 强调需要做退货推料&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:53,&quot;y&quot;:0}},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;dakdbwilvqw0&quot;,&quot;created&quot;:1749712540700,&quot;text&quot;:&quot;人工介入&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:96.24999856576324,&quot;y&quot;:1.2499999813735485},&quot;note&quot;:&quot;程序做错误提醒, 强调需要做退货推料\n\n1. 商务退货, 采购退料\n2. 之后财务在采购订单列表, 勾选此单据进行分期出入库处理&quot;},&quot;children&quot;:[]}]}]}]},{&quot;data&quot;:{&quot;id&quot;:&quot;dakct0erfmo0&quot;,&quot;created&quot;:1749711060255,&quot;text&quot;:&quot;不一致&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:78.74999882653378,&quot;y&quot;:46.24999931082118},&quot;note&quot;:&quot;1. 程序做错误提醒, 强调需要人工介入检查\n2. 人工介入调整后, 财务手动勾选执行分期出入库&quot;},&quot;children&quot;:[]}]}]}]},{&quot;data&quot;:{&quot;id&quot;:&quot;dahucnxhqnk0&quot;,&quot;created&quot;:1749455879371,&quot;text&quot;:&quot;采购订单新变更单&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:98.74999957159162,&quot;y&quot;:98.24999960884452},&quot;note&quot;:&quot;这种情况, 应该单独处理, 即属于分期的采购订单新变更单, 审核前节点立即处理\n\n1. 在采购订单新变更单的已审核节点, 增加被动式触发操作&quot;,&quot;progress&quot;:null},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;dahwy6kwwxc0&quot;,&quot;created&quot;:1749463207837,&quot;text&quot;:&quot;仅金额变更&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:64,&quot;y&quot;:-25}},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;dakghnx1eqg0&quot;,&quot;created&quot;:1749721455496,&quot;text&quot;:&quot;校验已缴费金额和采购入库单金额&quot;,&quot;note&quot;:&quot;1. 校验已缴费金额和采购入库单金额是否一致\n2. 校验已缴费期数和采购入库单期数是否一致&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:51.24999923631549,&quot;y&quot;:-1.2499999813735485}},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;dakghu2lv480&quot;,&quot;created&quot;:1749721468893,&quot;text&quot;:&quot;一致&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:62.499999068677425,&quot;y&quot;:-26.249999608844604}},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;dakdt9xlo340&quot;,&quot;created&quot;:1749713902095,&quot;text&quot;:&quot;已缴费金额&amp;lt;采购订单金额&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:98.74999852851033,&quot;y&quot;:0}},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;dakdug8x0lc0&quot;,&quot;created&quot;:1749713994204,&quot;text&quot;:&quot;重置剩余应付记录&quot;,&quot;priority&quot;:4,&quot;layout_right_offset&quot;:{&quot;x&quot;:98.74999852851033,&quot;y&quot;:-2.499999962747097},&quot;note&quot;:&quot;1. 将未勾选的应付记录, 全部删除\n2. 生成应付记录 = (采购订单金额-已缴费金额)/剩余期数&quot;},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;dakdvaxsmnk0&quot;,&quot;created&quot;:1749714061012,&quot;text&quot;:&quot;下推采购入库单&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:128.7499980814755,&quot;y&quot;:0},&quot;priority&quot;:5},&quot;children&quot;:[]}]}]},{&quot;data&quot;:{&quot;id&quot;:&quot;dakdtmjal0g0&quot;,&quot;created&quot;:1749713929528,&quot;text&quot;:&quot;已缴费金额&amp;gt;采购订单金额&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:119.99999821186066,&quot;y&quot;:16.24999975785613}},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;dakdbwilvqw0&quot;,&quot;created&quot;:1749712540700,&quot;text&quot;:&quot;人工介入&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:104.99999843537807,&quot;y&quot;:-2.4999999627469833},&quot;note&quot;:&quot;程序做错误提醒, 强调需要做退货推料\n\n1. 商务退货, 采购退料(在采购订单变更单时已介入)\n2. 入库单金额退料至与采购订单金额一致\n\n&quot;},&quot;children&quot;:[]}]},{&quot;data&quot;:{&quot;id&quot;:&quot;dakdu23jmy80&quot;,&quot;created&quot;:1749713963405,&quot;text&quot;:&quot;已缴费金额=采购订单金额&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:129.99999806284904,&quot;y&quot;:38.74999942258006}},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;dakdw0q0f6o0&quot;,&quot;created&quot;:1749714117138,&quot;text&quot;:&quot;删除剩余应付记录&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:93.74999860301614,&quot;y&quot;:-2.499999962747097},&quot;priority&quot;:4,&quot;note&quot;:&quot;1. 将未勾选的应付记录删除&quot;},&quot;children&quot;:[]}]}]},{&quot;data&quot;:{&quot;id&quot;:&quot;dakghwna4e00&quot;,&quot;created&quot;:1749721474497,&quot;text&quot;:&quot;不一致&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:59.99999910593033,&quot;y&quot;:31.249999534338826},&quot;note&quot;:&quot;1. 程序做错误提醒, 强调需要人工介入检查\n2. 中断变更单审核动作\n3. 人工介入调整已缴费金额和采购入库单金额一致后, 重新审核执行\n&quot;},&quot;children&quot;:[]}]}]},{&quot;data&quot;:{&quot;id&quot;:&quot;dahwy7t5oyw0&quot;,&quot;created&quot;:1749463210512,&quot;text&quot;:&quot;项目变更&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:68,&quot;y&quot;:61}},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;dakel7bwosw0&quot;,&quot;created&quot;:1749716090628,&quot;text&quot;:&quot;人工介入&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:73,&quot;y&quot;:-2},&quot;note&quot;:&quot;1. 商务退货,采购退料 (全退)\n2. 采购做采购订单新变更单, 财务审核&quot;},&quot;children&quot;:[{&quot;data&quot;:{&quot;id&quot;:&quot;dake9ih7kpc0&quot;,&quot;created&quot;:1749715174522,&quot;text&quot;:&quot;清理下游数据&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:86,&quot;y&quot;:-1},&quot;note&quot;:&quot;程序做错误提醒, 强调需要做退货推料\n\n1. 将已勾选/未勾选应付记录 全部删除&quot;},&quot;children&quot;:[]}]}]}]}]}]},{&quot;data&quot;:{&quot;id&quot;:&quot;daeh7vq8cg80&quot;,&quot;created&quot;:1749114150227,&quot;text&quot;:&quot;确认应收账期数 &amp;lt;= 1 OR 为空&quot;,&quot;layout_right_offset&quot;:{&quot;x&quot;:61,&quot;y&quot;:-47},&quot;progress&quot;:null},&quot;children&quot;:[]}]},{&quot;data&quot;:{&quot;id&quot;:&quot;daehavvdajs0&quot;,&quot;created&quot;:1749114385630,&quot;text&quot;:&quot;销售订单数量 ≠ 1&quot;,&quot;priority&quot;:null,&quot;progress&quot;:null,&quot;layout_right_offset&quot;:{&quot;x&quot;:49,&quot;y&quot;:-11}},&quot;children&quot;:[]}]}]},{&quot;data&quot;:{&quot;id&quot;:&quot;dantsq2bru00&quot;,&quot;created&quot;:1750063676474,&quot;text&quot;:&quot;全局备注&quot;,&quot;layout_mind_offset&quot;:{&quot;x&quot;:306,&quot;y&quot;:105},&quot;note&quot;:&quot;1. 期数计算公式:\n(dateTime2.Year - dateTime.Year) * 12 + dateTime2.Month - dateTime.Month\n(服务终止时间年份-服务开始时间年份)*12+服务终止时间月份-服务开始时间月份\n\n2. 期数归集:\n服务开始时间在当月15号以前(含15号), 则在当月触发, 如果在15号之后, 则在次月触发 \n\n3. 采购入库单新增字段\n3.1 销售订单编号\n3.2 入库账期\n3.3 辅助金额\n3.4 应付记录-缴费日期\n\n4. 其他出库单新增字段\n4.1 销售订单编号\n4.2 出库账期\n4.3 辅助金额\n\n5. BOS后台配置单据转换规则 (采购订单下推其他出库单), 加入新增字段转换\n\n6. 操作执行计划列表, 将\&quot;采购自动产生应付\&quot;执行计划停用, 并且发布新的执行计划\n\n7. 在采购订单中将\&quot;采购信息\&quot;,\&quot;提货方式\&quot;,\&quot;交易方式\&quot;设为必填 (对接罗鹏飞)\n\n8. 将物料列表中的所有未禁用物料, 维护批号规则 (对接陈伟强)&quot;},&quot;children&quot;:[]}]},&quot;template&quot;:&quot;right&quot;,&quot;theme&quot;:&quot;fish&quot;,&quot;version&quot;:&quot;1.4.43&quot;}" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="140" y="60" width="560" height="1870" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
